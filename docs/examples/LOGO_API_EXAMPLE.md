# Logo.dev API Integration Example

This document provides examples of how the logo extraction functionality works in the products API.

## Overview

The products API now automatically extracts and generates company logos using the logo.dev service. This happens automatically when fetching products from the database.

## How It Works

### 1. Logo Service (`src/lib/logoService.ts`)

The logo service provides utilities to generate logo URLs from:
- **Domain names** (e.g., `shopify.com`, `ellijewelry.com`)
- **Brand names** (e.g., `Shopify`, `Ellijewelry`)
- **Product URLs** (automatically extracts domain)

### 2. Automatic Logo Generation

When the products API fetches products, it:
1. Extracts the domain from the product URL (if available)
2. Falls back to the brand name
3. Generates a logo.dev URL
4. Returns it in the brand object

## API Response Format

### Request
```bash
GET /api/products?page=1&limit=10
```

### Response
```json
{
  "products": [
    {
      "id": "prod_123",
      "name": "Halskette Geo",
      "sku": "0201493117_16",
      "image": "https://cdn.shopify.com/...",
      "price": 49.90,
      "currency": "EUR",
      "channel": "shopify",
      "brand": {
        "id": "ellijewelry",
        "name": "Ellijewelry",
        "logo": "https://img.logo.dev/ellijewelry.com?format=png&size=64&token=pk_bjGBOZlPTmCYjnqmgu3OpQ"
      },
      "category": {
        "id": "jewelry",
        "name": "Jewelry",
        "slug": "jewelry"
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "totalPages": 10
  }
}
```

## Logo Service API

### Basic Usage

```typescript
import { generateLogoUrl } from '@/lib/logoService';

// Using a domain
const logo1 = generateLogoUrl('shopify.com');
// Result: 'https://img.logo.dev/shopify.com?format=png&size=64&token=...'

// Using a brand name
const logo2 = generateLogoUrl('Ellijewelry');
// Result: 'https://img.logo.dev/ellijewelry.com?format=png&size=64&token=...'

// With custom options
const logo3 = generateLogoUrl('shopify.com', {
  format: 'svg',
  size: 128
});
// Result: 'https://img.logo.dev/shopify.com?format=svg&size=128&token=...'
```

### Advanced Usage

#### Extract Domain from URL
```typescript
import { extractDomainFromUrl, generateLogoUrl } from '@/lib/logoService';

const productUrl = 'https://ellijewelry.com/products/necklace';
const domain = extractDomainFromUrl(productUrl);
// Result: 'ellijewelry.com'

const logo = generateLogoUrl(domain);
// Result: 'https://img.logo.dev/ellijewelry.com?format=png&size=64&token=...'
```

#### With Fallback
```typescript
import { generateLogoUrlWithFallback } from '@/lib/logoService';

// Try domain first, fallback to brand name
const logo = generateLogoUrlWithFallback(
  extractedDomain,  // might be null
  brandName         // fallback
);
```

#### Channel Logos
```typescript
import { getChannelLogo, CHANNEL_LOGOS } from '@/lib/logoService';

// Get a specific channel logo
const shopifyLogo = getChannelLogo('shopify');
// Result: 'https://img.logo.dev/shopify.com?format=png&size=64&token=...'

// Or use predefined constants
const wooLogo = CHANNEL_LOGOS.woocommerce;
```

## Brand Name to Domain Mapping

The service includes intelligent brand-to-domain mapping for common brands:

| Brand Name | Domain |
|------------|--------|
| Shopify | shopify.com |
| Ellijewelry | ellijewelry.com |
| Nenalina | nenalina.com |
| Kuzzoi | kuzzoi.com |
| Pilgrim | pilgrim.net |
| Amoonic | amoonic.de |
| ... and many more |

### Fallback Strategy

If a brand is not in the predefined list, the service:
1. Cleans the brand name (lowercase, remove special chars)
2. Tries common TLDs (.com, .net, .de, .co.uk, .io)
3. Returns the first potential domain (.com by default)

## Logo Display Options

### Format Options
- **PNG**: Best for general web use (default)
- **SVG**: Best for scalable vector graphics
- **JPG**: Best for smaller file sizes

### Size Options
- **40px**: Small icons
- **64px**: Standard size (default, recommended)
- **128px**: Large, high-resolution logos

## Integration in Product Catalog

The catalog page (`src/app/(site)/[lang]/(app)/catalog/page.tsx`) automatically displays logos from the API:

```typescript
<JewelryProductCell 
  product={{
    ...product,
    brand: {
      name: product.brand.name,
      logo: product.brand.logo  // ← Automatically generated by API
    }
  }}
/>
```

## Error Handling

The logo service handles errors gracefully:
- Returns `null` for invalid inputs
- Frontend displays fallback (first letter of brand name)
- No errors thrown, safe to use anywhere

```typescript
// Invalid inputs return null safely
generateLogoUrl(null);        // → null
generateLogoUrl('');           // → null
generateLogoUrl(undefined);    // → null
```

## Environment Configuration

### Logo.dev Token

The token is configured in the logo service:

```typescript
// In src/lib/logoService.ts
const LOGO_DEV_TOKEN = process.env.NEXT_PUBLIC_LOGO_DEV_TOKEN || 'pk_bjGBOZlPTmCYjnqmgu3OpQ';
```

### Setting Custom Token

Create a `.env.local` file:

```env
NEXT_PUBLIC_LOGO_DEV_TOKEN=your_custom_token_here
```

**Note**: The token is prefixed with `NEXT_PUBLIC_` so it can be used in client-side components if needed.

## Testing the API

### Using cURL
```bash
# Fetch products with logos
curl http://localhost:3000/api/products?page=1&limit=5

# Search for specific brand
curl http://localhost:3000/api/products?search=Ellijewelry

# Filter by brand
curl http://localhost:3000/api/products?brandId=ellijewelry
```

### Using JavaScript/TypeScript
```typescript
// In your component or service
async function fetchProductsWithLogos() {
  const response = await fetch('/api/products?page=1&limit=10');
  const data = await response.json();
  
  // All products now have logos in brand.logo
  data.products.forEach(product => {
    if (product.brand?.logo) {
      console.log(`${product.brand.name}: ${product.brand.logo}`);
    }
  });
  
  return data;
}
```

## Example Output

### Console Log Example
```
Ellijewelry: https://img.logo.dev/ellijewelry.com?format=png&size=64&token=pk_bjGBOZlPTmCYjnqmgu3OpQ
Nenalina: https://img.logo.dev/nenalina.com?format=png&size=64&token=pk_bjGBOZlPTmCYjnqmgu3OpQ
Kuzzoi: https://img.logo.dev/kuzzoi.com?format=png&size=64&token=pk_bjGBOZlPTmCYjnqmgu3OpQ
```

## Performance Considerations

### Caching
Logo.dev URLs are static and can be cached:
- Browser cache: Logos load from cache after first visit
- CDN: Logo.dev uses CDN for fast delivery worldwide
- No server-side caching needed

### Lazy Loading
```typescript
// In your component
<img 
  src={brand.logo}
  alt={brand.name}
  loading="lazy"  // ← Browser-native lazy loading
  className="w-8 h-8"
/>
```

### Error Handling in UI
```typescript
<img 
  src={brand.logo}
  alt={brand.name}
  onError={(e) => {
    // Fallback to first letter
    e.currentTarget.style.display = 'none';
    e.currentTarget.nextElementSibling?.classList.remove('hidden');
  }}
/>
<div className="fallback-logo hidden">
  {brand.name.charAt(0).toUpperCase()}
</div>
```

## Troubleshooting

### Logo Not Loading
**Issue**: Logo shows fallback instead of actual logo

**Solutions**:
1. Check if domain extraction is working:
   ```typescript
   console.log(extractDomainFromUrl(product.product_url));
   ```
2. Verify brand name mapping:
   ```typescript
   console.log(generateLogoUrl(product.product_brand));
   ```
3. Test URL directly in browser
4. Check network tab for 404 errors

### Wrong Logo Displayed
**Issue**: Logo doesn't match the brand

**Solutions**:
1. Add brand mapping in `logoService.ts`:
   ```typescript
   const brandMappings: Record<string, string> = {
     'YourBrand': 'correctdomain.com',
     // ... other mappings
   };
   ```
2. Ensure product URL is correct in database
3. Check brand name spelling

### Performance Issues
**Issue**: Many logos loading slowly

**Solutions**:
1. Enable lazy loading
2. Reduce image size (use 40px or 64px instead of 128px)
3. Use PNG instead of SVG for better caching
4. Consider pagination (already implemented)

## Future Enhancements

### Planned Features
- [ ] Logo quality detection
- [ ] Automatic fallback to alternative logo sources
- [ ] Logo caching in database
- [ ] Batch logo preloading
- [ ] Logo A/B testing
- [ ] Custom logo upload support

## Attribution

This implementation uses logo.dev service. If using the free plan, consider adding attribution:

```html
<a href="https://logo.dev" target="_blank" rel="noopener noreferrer">
  Logos provided by Logo.dev
</a>
```

## Related Files

- **Logo Service**: `src/lib/logoService.ts`
- **Products API**: `src/app/api/products/route.ts`
- **Catalog Page**: `src/app/(site)/[lang]/(app)/catalog/page.tsx`
- **Integration Guide**: `docs/guides/LOGO_DEV_INTEGRATION_GUIDE.md`

## Support

For issues or questions:
1. Check the [Logo.dev Integration Guide](../guides/LOGO_DEV_INTEGRATION_GUIDE.md)
2. Review the [Logo.dev Documentation](https://logo.dev/docs)
3. Check the troubleshooting section above

---

**Last Updated**: October 7, 2025
**Version**: 1.0.0

